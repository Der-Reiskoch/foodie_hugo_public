(()=>{var u="%s comments are waiting for approval",w="A comment is waiting for approval";var i={read:{method:"GET",interval:6e4},write:{method:"POST"}};var y=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),m=y;var B=(t,e,o)=>{let r=new Object;m(e,"sectionId")&&(r.sid=e.sectionId),m(e,"pageId")&&(r.pid=e.pageId);let s=!0;for(let n in r)m(r,n)&&(t+=(s?"?":"&")+n+"="+r[n]),s=!1;if(m(r,"sid")&&m(r,"pid")){let n=new XMLHttpRequest;n.open(i.read.method,t),n.onload=()=>{o(n.responseText)},n.send()}else window.logger.error("no sectionId or pageId")},D=B;var A=(t,e,o)=>{let r=new FormData;for(let n in e)r.append(n,e[n]);let s=new XMLHttpRequest;s.open(i.write.method,t),s.onload=()=>{o(s.responseText)},s.send(r)},C=A;var P=function(){let t=["cache"];window.caches.keys().then(e=>Promise.all(e.map(o=>{if(!t.includes(o))return window.caches.delete(o)})))},c=P;var E=t=>{let e="";return t&&(e=t.replace(/(?:\r\n|\r|\n)/g,"<br>")),e},v=E;var L=t=>{let e=null;return t&&(e=document.createElement("div"),e.className="row",e.innerHTML=t),e},l=L;var $=(t,e,o)=>{let r="";return t&&o&&(r=`<div class="meta"><div class="name">${e?`<a href="${e}" target="_blank" rel="noopener">${t}</a>`:t}</div><div class="time">${o}</div></div>`),r},h=$;var k=(t,e,o,r,s)=>{let n="";if(t&&o){let d="";s&&(s.toLowerCase()==="author"&&(d="from-author"),s.toLowerCase()==="to-be-approved"&&(d="to-be-approved"));let x=h(t,e,r);n=`<div class="msg ${d}">${o}</div>`+x}return n},p=k;var F=t=>new Date(Date.now()).toLocaleDateString(t,{year:"numeric",month:"2-digit",day:"2-digit"}),T=F;var M=(t,e,o)=>{if(t>0&&e&&o){let r=t===1?e:o.replace("%s",`${t}`),s=T("de-DE");return p("Der Reiskoch","https://www.der-reiskoch.de",r,s,"to-be-approved")}else return""},I=M;var a=null,j=t=>{let e=document.getElementById("js-comments-output");e.innerHTML="";let o=null;try{o=JSON.parse(t)}catch(r){console.error(r)}if(o){let r=o.comments,s=o.numberOfToBeApprovedComments;if(s>0){let n=I(s,w,u);e.appendChild(l(n))}r&&r.forEach(n=>{let d=p(n.name,n.website,v(n.message),n.date,n.type);e.appendChild(l(d))})}},f=()=>{c();let t=new FormData(a);if(t){let e=t.get("sid"),o=t.get("pid");if(e&&o){let r={sectionId:e,pageId:o};D(a.action,r,s=>{j(s)})}}},N=()=>{let t=new FormData(a),e={sid:t.get("sid"),pid:t.get("pid"),name:t.get("name"),email:t.get("email"),website:t.get("website"),msg:t.get("message")};C(a.action,e,o=>{o&&o.trim()==="OK"?(a.reset(),c(),f()):console.error(o)})};window.addEventListener("load",()=>{a=document.getElementById("js-comments-form"),a&&a.addEventListener("submit",e=>{e.preventDefault(),e.stopPropagation(),console.log("submit comment form"),N()});let t=new FormData(a);t.get("sid")&&t.get("pid")&&(f(),setInterval(()=>{f()},i.read.interval))});})();
