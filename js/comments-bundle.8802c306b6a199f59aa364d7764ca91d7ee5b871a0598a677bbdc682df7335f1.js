(()=>{var v="%s Kommentare warten auf Freigabe",h="Ein Kommentar wartet auf Freigabe";var s={read:{url:"https://kommentiere-den.reisko.ch/",method:"GET",interval:6e4},write:{url:"https://kommentiere-den.reisko.ch/",method:"POST"}};var P=function(e,r){var t=s.read.url,o=new Object;e.hasOwnProperty("sectionId")&&(o.sid=e.sectionId),e.hasOwnProperty("pageid")&&(o.pid=e.pageid);var a=!0;for(var n in o)o.hasOwnProperty(n)&&(t+=(a?"?":"&")+n+"="+o[n]),a=!1;if(o.hasOwnProperty("sid")&&o.hasOwnProperty("pid")){var i=new XMLHttpRequest;i.open(s.read.method,t),i.onload=r,i.send()}else console.error("no sectionId or pageId")},w=P;var B=function(e,r){var t=s.write.url,o=new FormData;for(let n in e)o.append(n,e[n]);var a=new XMLHttpRequest;a.open(s.write.method,t),a.onload=r,a.send(o)},g=B;var E=function(){var e=["content"];caches.keys().then(r=>Promise.all(r.map(t=>{if(!e.includes(t))return caches.delete(t)})))},f=E;var I=function(e){var r="";return e&&(r=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),r},D=I;var L=function(e){let r="";return e&&(r=document.createElement("div"),r.className="row",r.innerHTML=e),r},c=L;function y(e,r,t){let o="";if(e&&t){var a=r?`<a href="${r}" target="_blank" rel="noopener">${e}</a>`:e;o=`<div class="meta"><div class="name">${a}</div><div class="time">${t}</div></div>`}return o}var C=y;function F(e,r,t,o,a){let n="";if(e&&t){var i="";a&&(a.toLowerCase()==="author"&&(i="from-author"),a.toLowerCase()==="to-be-approved"&&(i="to-be-approved"));var m=C(e,r,o);n=`<div class="msg ${i}">${t}</div>`+m}return n}var d=F;var k=function(e){var r=new Date(Date.now()),t=r.toLocaleDateString(e,{year:"numeric",month:"2-digit",day:"2-digit"});return t},b=k;var A=function(e,r,t){if(e>0&&r&&t){var o=e===1?r:t.replace("%s",e),a=b("de-DE");return d("Der Reiskoch","http://der.reisko.ch",o,a,"to-be-approved")}else return""},T=A;var p=null,M=function(e){let r=document.getElementById("cwrap");r.innerHTML="";var t=null;try{t=JSON.parse(e)}catch(i){console.error(i)}if(t){var o=t.comments,a=t.numberOfToBeApprovedComments;if(a>0){var n=T(a,h,v);r.appendChild(c(n))}o&&o.forEach(m=>{var m=d(m.name,m.website,D(m.message),m.date,m.type);r.appendChild(c(m))})}},l=function(){f();var e=new FormData(p);let r={sectionId:e.get("sid"),pageid:e.get("pid")};w(r,function(){M(this.response)})},$=function(){var e=new FormData(p);return g({sid:e.get("sid"),pid:e.get("pid"),name:e.get("name"),email:e.get("email"),website:e.get("website"),msg:e.get("message")},function(){this.response&&this.response.trim()==="OK"?(p.reset(),f(),l()):console.error(this.response)}),!1};window.addEventListener("load",function(e){p=document.getElementById("js-comments-form"),formData=new FormData(p),formData.get("sid")&&formData.get("pid")&&(l(),setInterval(function(){l()},s.read.interval)),p&&(p.onsubmit=function(){return $(this)})});})();
