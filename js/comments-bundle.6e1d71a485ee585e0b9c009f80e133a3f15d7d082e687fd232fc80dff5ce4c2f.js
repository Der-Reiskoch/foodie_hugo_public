(()=>{var v="%s Kommentare warten auf Freigabe",g="Ein Kommentar wartet auf Freigabe";var s={read:{url:"https://kommentiere-den.reisko.ch/",method:"GET",interval:6e4},write:{url:"https://kommentiere-den.reisko.ch/",method:"POST"}};var P=function(e,r){var t=s.read.url,o=new Object;e.hasOwnProperty("sectionId")&&(o.sid=e.sectionId),e.hasOwnProperty("pageid")&&(o.pid=e.pageid);var a=!0;for(var i in o)o.hasOwnProperty(i)&&(t+=(a?"?":"&")+i+"="+o[i]),a=!1;if(o.hasOwnProperty("sid")&&o.hasOwnProperty("pid")){var n=new XMLHttpRequest;n.open(s.read.method,t),n.onload=r,n.send()}else console.error("no sectionId or pageId")},h=P;var y=function(e,r){var t=s.write.url,o=new FormData;for(let i in e)o.append(i,e[i]);var a=new XMLHttpRequest;a.open(s.write.method,t),a.onload=r,a.send(o)},w=y;var B=function(){var e=["content"];caches.keys().then(r=>Promise.all(r.map(t=>{if(!e.includes(t))return caches.delete(t)})))},f=B;var E=function(e){var r="";return e&&(r=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),r},D=E;var I=function(e){let r=null;return e&&(r=document.createElement("div"),r.className="row",r.innerHTML=e),r},l=I;function L(e,r,t){let o="";if(e&&t){var a=r?`<a href="${r}" target="_blank" rel="noopener">${e}</a>`:e;o=`<div class="meta"><div class="name">${a}</div><div class="time">${t}</div></div>`}return o}var C=L;function F(e,r,t,o,a){let i="";if(e&&t){var n="";a&&(a.toLowerCase()==="author"&&(n="from-author"),a.toLowerCase()==="to-be-approved"&&(n="to-be-approved"));var d=C(e,r,o);i=`<div class="msg ${n}">${t}</div>`+d}return i}var p=F;var k=function(e){var r=new Date(Date.now()),t=r.toLocaleDateString(e,{year:"numeric",month:"2-digit",day:"2-digit"});return t},b=k;var A=function(e,r,t){if(e>0&&r&&t){var o=e===1?r:t.replace("%s",e),a=b("de-DE");return p("Der Reiskoch","http://der.reisko.ch",o,a,"to-be-approved")}else return""},T=A;var m=null,M=function(e){let r=document.getElementById("cwrap");r.innerHTML="";var t=null;try{t=JSON.parse(e)}catch(n){console.error(n)}if(t){var o=t.comments,a=t.numberOfToBeApprovedComments;if(a>0){var i=T(a,g,v);r.appendChild(l(i))}o&&o.forEach(n=>{var d=p(n.name,n.website,D(n.message),n.date,n.type);r.appendChild(l(d))})}},c=function(){f();var e=new FormData(m);let r={sectionId:e.get("sid"),pageid:e.get("pid")};h(r,function(){M(this.response)})},$=function(){var e=new FormData(m);return w({sid:e.get("sid"),pid:e.get("pid"),name:e.get("name"),email:e.get("email"),website:e.get("website"),msg:e.get("message")},function(){this.response&&this.response.trim()==="OK"?(m.reset(),f(),c()):console.error(this.response)}),!1};window.addEventListener("load",function(e){m=document.getElementById("js-comments-form"),formData=new FormData(m),formData.get("sid")&&formData.get("pid")&&(c(),setInterval(function(){c()},s.read.interval)),m&&(m.onsubmit=function(){return $(this)})});})();
